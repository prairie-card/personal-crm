# PoC Phase 1: 詳細インタラクション仕様

このドキュメントは、Personal CRM PoC Phase 1の詳細なインタラクション仕様を定義します。

ハイレベルな画面構成については [`poc_phase1.md`](./poc_phase1.md) を参照してください。

---

## 目次

1. [Add Buttonフロー](#add-buttonフロー)
2. [Notificationシステム](#notificationシステム)
3. [Home画面：新着コンタクトカード群](#home画面新着コンタクトカード群)
4. [Keep-in-Touch設定](#keep-in-touch設定)
5. [共通インタラクションパターン](#共通インタラクションパターン)

---

## Add Buttonフロー

### 概要
ユーザーが新しいコンタクトを追加する主要な導線。名刺読み取りを中心とした直感的なフローを提供します。

### iPhone View フロー

#### 1. Add Buttonタップ
- **配置**: 右下にFAB（Floating Action Button）として固定配置
- **視覚**: プライマリカラー、＋アイコン
- **タップ後**: 名刺読み取りカメラ起動

#### 2. 名刺読み取り
- **カメラUI**: 
  - ガイド枠表示（名刺サイズの推奨範囲）
  - 「名刺全体が収まるように撮影してください」ヒント表示
  - シャッターボタン（中央下部）
  - キャンセルボタン（左上）
- **撮影完了**: シャッター音 + 視覚フィードバック

#### 3. ローディング画面
- **表示内容**:
  - アニメーション（スピナーまたはプログレスインジケーター）
  - ステータステキスト: 「名刺を読み取り中...」
  - 推定時間: 2-5秒
- **処理内容**: OCR処理 + 基本情報抽出

#### 4. 作成完了フィードバック
- **表示**: 
  - 「作成されました！」トーストメッセージ
  - チェックマークアニメーション
- **動作**: 
  - 0.8秒表示後、自動でフェードアウト
  - 即座にコンタクト詳細画面へ遷移

#### 5. コンタクト作成/編集画面
新規作成されたコンタクトの詳細を表示・編集する画面。

**画面構成**（上から下へ）:

```
┌─────────────────────────────┐
│ [< 閉じる]           [保存] │ ← Header
├─────────────────────────────┤
│  👤 プロフィール画像/絵文字    │
│                             │
│  名前: [山田 太郎]          │
│  会社: [株式会社Example]     │
│  役職: [営業部長]           │
│  メール: [追加する]         │
│  電話: [追加する]           │
├─────────────────────────────┤
│  📅 作成日付               │
│  2025/10/08                │
├─────────────────────────────┤
│  📍 出会った場所           │
│  [入力してください]         │
├─────────────────────────────┤
│  🏷️ タグ                  │
│  [紙名刺読み取り] [ビジネス] │
├─────────────────────────────┤
│  ✨ フォローアップ          │
│  [フォローアップ文章を作成] │
├─────────────────────────────┤
│  📝 メモ                   │
│  [自由記入欄]              │
│  （複数行テキストエリア）    │
└─────────────────────────────┘
```

**各フィールド詳細**:

- **プロフィール画像/絵文字**: 
  - デフォルト: 役職や業種に応じた絵文字（💼 👔 👨‍💼 👩‍💼 等）
  - タップで画像選択可能（後期実装）
  
- **基本情報フィールド**: 
  - OCRで読み取れた情報は自動入力済み
  - 各フィールドはタップで編集可能
  - 未取得項目は「[追加する]」リンク表示
  
- **作成日付**: 
  - 自動記録（読み取り実行日時）
  - タップで日付変更可能
  
- **出会った場所**: 
  - 自由入力（例: 「ABC展示会」「渋谷カフェ」）
  - 位置情報連携は後期検討
  
- **タグ**: 
  - 自動付与: 「紙名刺読み取り」
  - 追加タグ選択可能（プリセット + カスタム）
  
- **フォローアップボタン**: 
  - タップでAIフォローアップ文章生成モーダルを開く
  - [フォローアップ提案の仕様](#フォローアップ提案) 参照
  
- **メモ欄**: 
  - その場で気づいたこと、会話内容などを自由記入
  - プレースホルダー: 「どんな話をしましたか？印象に残ったことは？」

**アクション**:
- **[閉じる]**: コンタクトを保存してHome画面に戻る
- **[保存]**: 明示的な保存（編集内容を確定）

**動作**:
- 画面を閉じると、新しいコンタクトはHomeの「新着コンタクトカード群」に追加される
- フォローアップを作成しなくても保存可能（後から処理できる）

### PC版フロー（参考）

PC版では以下の3つのモードを提供:

1. **名刺アップロード**: 画像/PDFファイルをドラッグ&ドロップまたは選択
2. **手動入力**: フォームに直接入力
3. **Prairie履歴から選択**: 後期実装（外部連携）

---

## Notificationシステム

### 概要
ユーザーへの通知とバックグラウンド処理の進捗を管理するシステム。

### Header Notification Icon

**配置**: 
- iPhone: 画面右上（ベルアイコン）
- PC: Sidebar上部またはHeader右側

**状態表示**:
- 未読あり: バッジ数字表示（赤丸）
- 未読なし: グレーアイコン
- 処理中: アニメーション（パルス効果）

### Notification Modal

#### モーダル構造

```
┌─────────────────────────────┐
│ 通知              [× 閉じる] │
├─────────────────────────────┤
│ [General] [AI検索]          │ ← タブ
├─────────────────────────────┤
│                             │
│  （選択されたタブの内容）     │
│                             │
│                             │
└─────────────────────────────┘
```

#### タブ1: General通知

**表示内容**:
- リマインダー通知
- フォローアップ提案完了通知
- 誕生日通知
- システムメッセージ

**通知カード構造**:
```
┌─────────────────────────────┐
│ 🎂 誕生日リマインダー         │
│ 山田太郎さんの誕生日です      │
│ 5分前                        │
└─────────────────────────────┘
```

**インタラクション**:
- タップで該当コンタクトまたはアクションに遷移
- スワイプで削除（既読化）
- 一括既読ボタン（右上）

#### タブ2: AI検索ステータス

**目的**:
名刺読み取り後のバックグラウンドAI処理（人物検索→コンタクト補完）のステータスを表示。

**処理フロー**:
1. 名刺読み取り完了
2. バックグラウンドでAIが以下を実行:
   - ネット検索（名前 + 会社名でGoogle検索）
   - SNS情報収集（LinkedIn、Twitter等）
   - プロフィール情報の抽出・構造化
3. 結果をコンタクトに自動マージ

**ステータス表示**:

```
┌─────────────────────────────┐
│ 🔍 山田太郎さん              │
│ ステータス: 検索開始          │
│ 2分前                        │
└─────────────────────────────┘

┌─────────────────────────────┐
│ ✅ 佐藤花子さん              │
│ ステータス: 検索完了          │
│ 3件の情報を追加しました       │
│ [確認する]                   │
│ 10分前                       │
└─────────────────────────────┘

┌─────────────────────────────┐
│ ⚠️ 鈴木一郎さん              │
│ ステータス: 情報が見つかりません│
│ [手動で追加]                 │
│ 15分前                       │
└─────────────────────────────┘
```

**ステータス種類**:
- 🔍 **検索開始**: AI処理がキューに追加された
- ⏳ **検索中**: AI処理実行中
- ✅ **検索完了**: 情報取得成功
- ⚠️ **情報未取得**: 該当する情報が見つからなかった
- ❌ **エラー**: 処理に失敗

**アクション**:
- **[確認する]**: 取得した情報をコンタクト詳細画面で確認
- **[手動で追加]**: コンタクト編集画面へ遷移
- スワイプで非表示

---

## Home画面：新着コンタクトカード群

### 概要
新しく追加されたコンタクトを「整理」し、今後の関係維持方法を決定する、Homeの最重要セクション。

### デザインコンセプト
- Tinderのスワイプインタラクション
- メールの「受信トレイ処理」のメンタルモデル
- 連続して快適に処理できるUX

### 表示条件
- **表示**: 未整理コンタクトが1件以上存在する場合
- **非表示**: 未整理コンタクトが0件の場合
  - 代わりに「すべて整理済みです！✨」メッセージ表示

### カード表示エリア

#### ヘッダー

```
┌─────────────────────────────┐
│ 📇 新着コンタクト             │
│ 未整理: 7件 (3/7 完了)       │ ← 進捗表示
└─────────────────────────────┘
```

**進捗表示**:
- 総数と処理済み件数を表示
- プログレスバー（オプション）

#### カードスタック

```
┌─────────────────────────────┐
│                             │
│      ┌─────────────┐        │
│      │  カード3    │        │ ← 背後のカード
│   ┌──┴─────────────┴──┐     │
│   │    カード2         │    │ ← 次のカード
│ ┌─┴────────────────────┴─┐  │
│ │                        │  │
│ │   👤  山田太郎          │  │ ← 最前面カード
│ │   株式会社Example      │  │
│ │   営業部長             │  │
│ │                        │  │
│ │   📅 2025/10/08        │  │
│ │   🏷️ 紙名刺読み取り     │  │
│ │                        │  │
│ └────────────────────────┘  │
│                             │
└─────────────────────────────┘
```

**表示枚数**: 最大5枚（ユーザーテスト結果で最大10枚まで調整可能）

### カード構造

#### カード表面（デフォルト）

```
┌────────────────────────────┐
│                            │
│      👤                    │ ← プロフィール画像/絵文字
│                            │
│    山田 太郎               │ ← 名前（大きく）
│    株式会社Example         │ ← 会社名
│    営業部長                │ ← 役職
│                            │
│  📅 2025/10/08            │ ← 作成日
│  🏷️ 紙名刺読み取り         │ ← タグ
│                            │
└────────────────────────────┘
```

**デザインポイント**:
- プロフィール画像/絵文字を強調（誰なのかを即座に認識）
- 名前が最も目立つフォントサイズ
- カード全体がフロート（影付き）で名刺っぽい見た目
- 白背景、角丸、ソフトシャドウ

**絵文字選択ロジック**:
名刺情報だけでは人物写真が取得できないため、役職や業種から最適な絵文字を自動選択:
- 営業系: 👔 💼
- 技術系: 👨‍💻 👩‍💻
- 経営層: 👨‍💼 👩‍💼
- デザイン系: 🎨
- その他: 👤

#### カードインタラクション

**カードタップ → Flip アニメーション**

カードをタップすると、カードが3D回転して裏面を表示:

```
[表面] → [タップ] → [180度回転アニメーション] → [裏面]
```

**アニメーション仕様**:
- 回転軸: Y軸（左右方向に回転）
- 所要時間: 0.4秒
- イージング: ease-in-out
- 再度タップで表面に戻る

#### カード裏面（詳細・編集）

```
┌────────────────────────────┐
│  [< 戻る]                  │
├────────────────────────────┤
│  メール:                   │
│  [Add email address]       │
│                            │
│  電話:                     │
│  [Add phone number]        │
│                            │
│  出会った場所:              │
│  [Add location]            │
│                            │
│  メモ:                     │
│  [Add description]         │
│                            │
│  🏷️ タグを追加:            │
│  [Instagram Contacts]      │
│  [+ タグを追加]            │
│                            │
└────────────────────────────┘
```

**機能**:
- 不足している情報を追加可能
- 各フィールドはタップでインライン編集
- タグは複数選択/追加可能
- 流入元タグの自動付与（例: 「紙名刺読み取り」「Instagram Contacts」）

### アクションエリア

カード下部に配置される、コンタクト処理の中核機能。

```
┌────────────────────────────┐
│  [🗄️ Archive]             │
│  [💌 Keep in Touch]        │
│  [⏰ Later]                │
└────────────────────────────┘
```

#### アクション詳細

**1. 🗄️ Archive（アーカイブ）**
- **意味**: このコンタクトは今すぐフォローアップ不要
- **動作**: 
  - カードがスワイプアウト（左または下方向）
  - コンタクトリストに移動（Active状態は維持）
  - 次のカードが表示される
- **用途**: 名刺交換したが今すぐ連絡する必要がない人

**2. 💌 Keep in Touch（キープインタッチ）**
- **意味**: このコンタクトと定期的に連絡を取りたい
- **動作**:
  - Keep-in-Touch設定モーダルを表示
  - 期間選択後、Reminderに登録
  - カードがスワイプアウト（右または上方向、ポジティブな方向）
- **用途**: 関係を維持したい重要なコンタクト

**3. ⏰ Later（あとで）**
- **意味**: 今は決められない、後で処理する
- **動作**:
  - カードをスタックの最後尾に移動
  - 次のカードが表示される
- **用途**: 情報不足や判断保留

#### モバイル最適化

**iPhoneでのショートカット操作**:
- **左スワイプ** → Archive
- **右スワイプ** → Keep in Touch設定へ
- **上スワイプ** → Later
- **タップ** → Flip（詳細表示）

**認知負荷の軽減**:
- 初回表示時にスワイプチュートリアル（オプション）
- スワイプ中にアイコンとラベルを表示（視覚的ヒント）
- ボタンも併用可能（タップでも操作できる）

---

## Keep-in-Touch設定

### 概要
コンタクトと定期的に連絡を取るためのリマインダー設定機能。

### 設定モーダル

カードで「Keep in Touch」を選択すると表示されるモーダル:

```
┌────────────────────────────┐
│  山田太郎さん               │
│  いつ連絡しますか？         │
├────────────────────────────┤
│  ⏰ 1週間後                │
│  ⏰ 3週間後                │
│  ⏰ 1ヶ月後                │
│  ✨ AIにおまかせ           │
│  🎂 誕生日 (4月15日)       │ ← 取得済みの場合のみ
├────────────────────────────┤
│  [キャンセル]  [設定する]  │
└────────────────────────────┘
```

### 選択肢詳細

#### 固定期間オプション

**1週間後 / 3週間後 / 1ヶ月後**:
- シンプルな固定期間
- ユーザーが自分で判断して選択
- 設定すると指定日にReminderが作成される

#### ✨ AIにおまかせ

**動作**:
- AIが以下の情報から最適なフォローアップタイミングを判断:
  - 関係性（初対面 / 既知）
  - 役職・立場
  - 前回のやり取り
  - 業界慣習
- 推奨期間を提案（例: 「2週間後がおすすめです」）
- ユーザーは承認または調整可能

**表示例**:
```
AIの提案: 2週間後
理由: ビジネス関係の初回フォローアップに最適です
[この提案で設定] [自分で選ぶ]
```

#### 🎂 誕生日オプション

**表示条件**:
- コンタクト情報に誕生日が登録されている場合のみ表示

**動作**:
- 誕生日当日にリマインダー通知
- 誕生日メッセージのテンプレート提案
- 毎年繰り返し（Recurring Reminder）

**表示例**:
```
🎂 誕生日 (4月15日)
誕生日にメッセージを送りましょう
[設定する]
```

### 設定後の動作

**1. Reminder登録**:
- 設定した日時にReminderが作成される
- Homeの「今日のReminder一覧」に表示される（該当日）

**2. カード処理完了**:
- カードがスワイプアウト（右方向、ポジティブアニメーション）
- 「設定しました！✨」フィードバック
- 次のカードが表示される

**3. 通知**:
- 設定日にプッシュ通知（モバイル）
- アプリ内Notification（一般タブ）

### Reminder表示（Home下部）

設定したKeep-in-Touchは、期日到来時にHome画面の「今日のReminder一覧」に表示:

```
┌────────────────────────────┐
│  📅 今日のReminder         │
├────────────────────────────┤
│  💌 山田太郎さん           │
│  フォローアップの時期です   │
│  [完了] [延期]            │
└────────────────────────────┘
```

**アクション**:
- **[完了]**: チェックマーク、Reminderを既読化
- **[延期]**: 新しい日時を設定（1週間後、カスタム）
- タップでコンタクト詳細へ遷移

---

## 共通インタラクションパターン

### フォローアップ提案

**トリガー**:
- 新規コンタクト作成時（自動）
- コンタクト詳細画面の「フォローアップ文章を作成」ボタン
- Reminder期日到来時

**モーダル構造**:

```
┌────────────────────────────┐
│  山田太郎さんへの           │
│  フォローアップ提案         │
├────────────────────────────┤
│  💡 提案理由:              │
│  展示会で名刺交換した直後   │
│  です。早めの連絡で印象を   │
│  残しましょう。             │
├────────────────────────────┤
│  📝 ドラフト:              │
│  山田さん                  │
│                            │
│  先日はABC展示会でお話     │
│  いただきありがとうござい   │
│  ました。〇〇についてぜひ   │
│  改めてお話しできればと     │
│  思います。                 │
│                            │
│  [編集可能なテキストエリア]│
├────────────────────────────┤
│  [📋 コピー]  [⏰ 後で]    │
│  [✅ 送信済にする]         │
└────────────────────────────┘
```

**提案理由（1行）**:
- なぜ今フォローアップすべきかをAIが簡潔に説明
- 例: 「初対面から3日が経過、関係構築に最適なタイミングです」

**ドラフト文面（3〜5行）**:
- AIが生成したメッセージテンプレート
- 編集可能（ユーザーがカスタマイズできる）
- 自然な日本語、ビジネス適切なトーン

**アクション**:
- **[📋 コピー]**: クリップボードにコピー、Gmail/Slackで使用
- **[⏰ 後で]**: Reminderに追加（日時選択）
- **[✅ 送信済にする]**: 送信完了をマーク、Activityログに記録

### モーダル共通仕様

**表示アニメーション**:
- 下から上にスライドイン（モバイル）
- フェードイン + スケール（PC）
- 所要時間: 0.3秒

**閉じる動作**:
- [×] ボタン（右上）
- 背景タップ（モーダル外）
- ESCキー（PC）
- 下方向スワイプ（モバイル）

**背景**:
- 半透明オーバーレイ（#000000 60%透明度）
- ブラー効果（オプション）

### Loading States

**統一ローディング表示**:
- スピナー: プライマリカラー、中央配置
- テキスト: 「読み込み中...」または具体的なステータス
- スケルトンスクリーン: リスト表示時に使用

### Error Handling

**エラー表示パターン**:
1. **トーストメッセージ**: 軽微なエラー（ネットワーク一時的切断など）
2. **モーダル**: 重大なエラー（処理失敗、再試行必要）
3. **インラインエラー**: フォームバリデーションエラー

**エラーメッセージ例**:
```
⚠️ 名刺の読み取りに失敗しました
もう一度撮影するか、手動で入力してください

[再試行] [手動入力]
```

### Empty States

**データが無い場合の表示**:

**新着コンタクトなし**:
```
✨ すべて整理済みです！
新しいコンタクトを追加しましょう

[+ 名刺を読み取る]
```

**Reminderなし**:
```
📅 今日のReminderはありません
いい一日を！
```

**Activityログなし**:
```
📊 まだアクティビティがありません
コンタクトとやり取りを始めましょう
```

---

## アニメーション仕様

### カードスワイプアニメーション

```javascript
// スワイプ方向によるアニメーション
右スワイプ（Keep in Touch）:
  - 移動: translateX(+100vw)
  - 回転: rotate(15deg)
  - フェード: opacity 1 → 0
  - 所要時間: 0.4s
  - ポジティブなエフェクト（緑のグロー）

左スワイプ（Archive）:
  - 移動: translateX(-100vw)
  - 回転: rotate(-15deg)
  - フェード: opacity 1 → 0
  - 所要時間: 0.4s
  - ニュートラルなエフェクト（グレーのフェード）

上スワイプ（Later）:
  - 移動: translateY(-100vh)
  - スケール: scale(0.8)
  - フェード: opacity 1 → 0
  - 所要時間: 0.3s
```

### カードFlipアニメーション

```javascript
// 3D Flip
transform: rotateY(180deg)
transition: transform 0.4s ease-in-out
preserve-3d: true
backface-visibility: hidden
```

### ローディングアニメーション

```javascript
// スピナー回転
animation: spin 1s linear infinite
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
```

---

## レスポンシブ対応

### ブレークポイント

```css
Mobile: < 640px
Tablet: 640px - 1024px
Desktop: > 1024px
```

### モバイル最適化

- **タッチターゲット**: 最小 44x44px
- **スワイプ感度**: 50px以上の移動で認識
- **スワイプ速度**: 0.3s以内で高速スワイプと判定
- **FABサイズ**: 56x56px（Material Design準拠）

### デスクトップ最適化

- **マウスホバー**: カードにホバー時、微妙な浮き上がり効果
- **キーボードショートカット**:
  - Enter: カードFlip
  - →: Keep in Touch
  - ←: Archive
  - ↓: Later
  - Esc: モーダルを閉じる

---

## アクセシビリティ

### ARIA対応

- **ロール**: button, dialog, tab, tabpanel等を適切に設定
- **ラベル**: すべてのインタラクティブ要素にaria-label
- **状態**: aria-expanded, aria-selected等でステート管理

### キーボードナビゲーション

- Tab順序の最適化
- Enter/Spaceでボタン実行
- Escapeでモーダル閉じる
- 矢印キーでカード操作（オプション）

### スクリーンリーダー対応

- 意味のある読み上げテキスト
- 視覚的なフィードバックと同時に音声通知（live region）
- 画像にalt属性

---

## パフォーマンス考慮事項

### 画像最適化

- プロフィール画像: 圧縮、WebP形式、遅延読み込み
- サムネイル: 低解像度版を先に表示

### OCR処理

- クライアントサイドOCR（可能な場合）
- サーバーサイドOCRはバックグラウンド処理
- タイムアウト: 10秒以内

### カードレンダリング

- 仮想スクロール: 大量のカードがある場合
- 最大表示枚数: 5-10枚に制限
- 残りはページネーション

---

## 実装優先度

### P0 (必須 - Phase 1.0)
- Add Button フロー（名刺読み取り → コンタクト作成）
- 新着コンタクトカード基本UI
- Keep-in-Touch設定（固定期間のみ）
- Reminder表示（基本）

### P1 (重要 - Phase 1.5)
- カードFlipアニメーション
- Notificationシステム（Generalタブ）
- AI検索ステータス（基本）
- フォローアップ提案（基本）

### P2 (追加機能 - Phase 2.0)
- スワイプジェスチャー最適化
- AIにおまかせ機能
- 誕生日Reminder
- キーボードショートカット

---

## 今後の拡張

- **音声入力**: メモや出会った場所を音声で記録
- **位置情報連携**: 出会った場所を自動記録
- **カレンダー連携**: 出会った日時をカレンダーイベントと紐付け
- **SNS連携**: LinkedInなどから自動で情報取得
- **チーム共有**: 組織内で重要コンタクトを共有

---

## 参考リンク

- [ハイレベル仕様: poc_phase1.md](./poc_phase1.md)
- [ベンチマーク: benchmarks.md](./benchmarks.md)
- [プロジェクト指示: プロジェクトの指示.md](./プロジェクトの指示.md)

